/**
 * jQuery Roundabout - v1.1
 * http://fredhq.com/projects/roundabout/
 *
 * Moves list-items of enabled ordered and unordered lists long
 * a chosen path. Includes the default "lazySusan" path, that
 * moves items long a spinning turntable.
 *
 * Terms of Use // jQuery Roundabout
 * 
 * Open source under the BSD license
 *
 * Copyright (c) 2010, Fred LeBlanc
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without 
 * modification, are permitted provided that the following conditions are met:
 * 
 *   - Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer.
 *   - Redistributions in binary form must reproduce the above 
 *     copyright notice, this list of conditions and the following 
 *     disclaimer in the documentation and/or other materials provided 
 *     with the distribution.
 *   - Neither the name of the author nor the names of its contributors 
 *     may be used to endorse or promote products derived from this 
 *     software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" 
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE 
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE 
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE 
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR 
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF 
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS 
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN 
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) 
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE 
 * POSSIBILITY OF SUCH DAMAGE.
 */jQuery.extend({roundabout_shape:{def:"lazySusan",lazySusan:function(e,t,n){return{x:Math.sin(e+t),y:Math.sin(e+3*Math.PI/2+t)/8*n,z:(Math.cos(e+t)+1)/2,scale:Math.sin(e+Math.PI/2+t)/2+.5}}}});jQuery.fn.roundabout=function(){var e=typeof arguments[0]!="object"?{}:arguments[0];e={bearing:typeof e.bearing=="undefined"?0:jQuery.roundabout_toFloat(e.bearing%360),tilt:typeof e.tilt=="undefined"?0:jQuery.roundabout_toFloat(e.tilt),minZ:typeof e.minZ=="undefined"?100:parseInt(e.minZ,10),maxZ:typeof e.maxZ=="undefined"?400:parseInt(e.maxZ,10),minOpacity:typeof e.minOpacity=="undefined"?.4:jQuery.roundabout_toFloat(e.minOpacity),maxOpacity:typeof e.maxOpacity=="undefined"?1:jQuery.roundabout_toFloat(e.maxOpacity),minScale:typeof e.minScale=="undefined"?.4:jQuery.roundabout_toFloat(e.minScale),maxScale:typeof e.maxScale=="undefined"?1:jQuery.roundabout_toFloat(e.maxScale),duration:typeof e.duration=="undefined"?600:parseInt(e.duration,10),btnNext:e.btnNext||null,btnPrev:e.btnPrev||null,easing:e.easing||"swing",clickToFocus:e.clickToFocus!==!1,focusBearing:typeof e.focusBearing=="undefined"?0:jQuery.roundabout_toFloat(e.focusBearing%360),shape:e.shape||"lazySusan",debug:e.debug||!1,childSelector:e.childSelector||"li",startingChild:typeof e.startingChild=="undefined"?null:parseInt(e.startingChild,10),reflect:typeof e.reflect=="undefined"||e.reflect===!1?!1:!0};this.each(function(t){var n=jQuery(this),r=jQuery.roundabout_toFloat(360/n.children(e.childSelector).length),i=e.startingChild===null?e.bearing:e.startingChild*r;n.addClass("roundabout-holder").css("padding",0).css("position","relative").css("z-index",e.minZ);n.data("roundabout",{bearing:i,tilt:e.tilt,minZ:e.minZ,maxZ:e.maxZ,minOpacity:e.minOpacity,maxOpacity:e.maxOpacity,minScale:e.minScale,maxScale:e.maxScale,duration:e.duration,easing:e.easing,clickToFocus:e.clickToFocus,focusBearing:e.focusBearing,animating:0,childInFocus:-1,shape:e.shape,period:r,debug:e.debug,childSelector:e.childSelector,reflect:e.reflect});e.clickToFocus===!0&&n.children(e.childSelector).each(function(t){jQuery(this).click(function(i){var s=e.reflect===!0?360-r*t:r*t;s=jQuery.roundabout_toFloat(s);if(!jQuery.roundabout_isInFocus(n,s)){i.preventDefault();n.data("roundabout").animating===0&&n.roundabout_animateAngleToFocus(s);return!1}})});e.btnNext&&jQuery(e.btnNext).bind("click.roundabout",function(e){e.preventDefault();n.data("roundabout").animating===0&&n.roundabout_animateToNextChild();return!1});e.btnPrev&&jQuery(e.btnPrev).bind("click.roundabout",function(e){e.preventDefault();n.data("roundabout").animating===0&&n.roundabout_animateToPreviousChild();return!1})});this.roundabout_startChildren();if(typeof arguments[1]=="function"){var t=arguments[1],n=this;setTimeout(function(){t(n)},0)}return this};jQuery.fn.roundabout_startChildren=function(){this.each(function(e){var t=jQuery(this),n=t.data("roundabout"),r=t.children(n.childSelector);r.each(function(e){var t=n.reflect===!0?360-n.period*e:n.period*e;jQuery(this).addClass("roundabout-moveable-item").css("position","absolute");jQuery(this).data("roundabout",{startWidth:jQuery(this).width(),startHeight:jQuery(this).height(),startFontSize:parseInt(jQuery(this).css("font-size"),10),degrees:t})});t.roundabout_updateChildPositions()});return this};jQuery.fn.roundabout_setTilt=function(e){this.each(function(t){jQuery(this).data("roundabout").tilt=e;jQuery(this).roundabout_updateChildPositions()});if(typeof arguments[1]=="function"){var t=arguments[1],n=this;setTimeout(function(){t(n)},0)}return this};jQuery.fn.roundabout_setBearing=function(e){this.each(function(t){jQuery(this).data("roundabout").bearing=jQuery.roundabout_toFloat(e%360,2);jQuery(this).roundabout_updateChildPositions()});if(typeof arguments[1]=="function"){var t=arguments[1],n=this;setTimeout(function(){t(n)},0)}return this};jQuery.fn.roundabout_adjustBearing=function(e){e=jQuery.roundabout_toFloat(e);e!==0&&this.each(function(t){jQuery(this).data("roundabout").bearing=jQuery.roundabout_getBearing(jQuery(this))+e;jQuery(this).roundabout_updateChildPositions()});if(typeof arguments[1]=="function"){var t=arguments[1],n=this;setTimeout(function(){t(n)},0)}return this};jQuery.fn.roundabout_adjustTilt=function(e){e=jQuery.roundabout_toFloat(e);e!==0&&this.each(function(t){jQuery(this).data("roundabout").tilt=jQuery.roundabout_toFloat(jQuery(this).roundabout_get("tilt")+e);jQuery(this).roundabout_updateChildPositions()});if(typeof arguments[1]=="function"){var t=arguments[1],n=this;setTimeout(function(){t(n)},0)}return this};jQuery.fn.roundabout_animateToBearing=function(e){e=jQuery.roundabout_toFloat(e);var t=new Date,n=typeof arguments[1]=="undefined"?null:arguments[1],r=typeof arguments[2]=="undefined"?null:arguments[2],i=typeof arguments[3]!="object"?null:arguments[3];this.each(function(s){var o=jQuery(this),u=o.data("roundabout"),a,f,l,c=n===null?u.duration:n,h=r!==null?r:u.easing||"swing";i===null&&(i={timerStart:t,start:jQuery.roundabout_getBearing(o),totalTime:c});a=t-i.timerStart;if(a<c){u.animating=1;if(typeof jQuery.easing.def=="string"){f=jQuery.easing[h]||jQuery.easing[jQuery.easing.def];l=f(null,a,i.start,e-i.start,i.totalTime)}else l=jQuery.easing[h](a/i.totalTime,a,i.start,e-i.start,i.totalTime);o.roundabout_setBearing(l,function(){o.roundabout_animateToBearing(e,c,h,i)})}else{e=e<0?e+360:e%360;u.animating=0;o.roundabout_setBearing(e)}});return this};jQuery.fn.roundabout_animateToDelta=function(e){var t=arguments[1],n=arguments[2];this.each(function(r){e=jQuery.roundabout_getBearing(jQuery(this))+jQuery.roundabout_toFloat(e);jQuery(this).roundabout_animateToBearing(e,t,n)});return this};jQuery.fn.roundabout_animateToChild=function(e){var t=arguments[1],n=arguments[2];this.each(function(r){var i=jQuery(this),s=i.data("roundabout");if(s.childInFocus!==e&&s.animating===0){var o=jQuery(i.children(s.childSelector)[e]);i.roundabout_animateAngleToFocus(o.data("roundabout").degrees,t,n)}});return this};jQuery.fn.roundabout_animateToNearbyChild=function(e,t){var n=e[0],r=e[1];this.each(function(e){var i=jQuery(this).data("roundabout"),s=jQuery.roundabout_toFloat(360-jQuery.roundabout_getBearing(jQuery(this))),o=i.period,u=0,a,f=i.reflect,l=jQuery(this).children(i.childSelector).length;s=f===!0?s%360:s;if(i.animating===0)if(f===!1&&t==="next"||f===!0&&t!=="next"){s=s===0?360:s;while(u<l){a={lower:jQuery.roundabout_toFloat(o*u),upper:jQuery.roundabout_toFloat(o*(u+1))};a.upper=u==l-1?360:a.upper;if(s<=a.upper&&s>a.lower){jQuery(this).roundabout_animateToDelta(s-a.lower,n,r);break}u++}}else for(;;){a={lower:jQuery.roundabout_toFloat(o*u),upper:jQuery.roundabout_toFloat(o*(u+1))};a.upper=u==l-1?360:a.upper;if(s>=a.lower&&s<a.upper){jQuery(this).roundabout_animateToDelta(s-a.upper,n,r);break}u++}});return this};jQuery.fn.roundabout_animateToNextChild=function(){return this.roundabout_animateToNearbyChild(arguments,"next")};jQuery.fn.roundabout_animateToPreviousChild=function(){return this.roundabout_animateToNearbyChild(arguments,"previous")};jQuery.fn.roundabout_animateAngleToFocus=function(e){var t=arguments[1],n=arguments[2];this.each(function(r){var i=jQuery.roundabout_getBearing(jQuery(this))-e;i=Math.abs(360-i)<Math.abs(0-i)?360-i:0-i;i=i>180?-(360-i):i;i!==0&&jQuery(this).roundabout_animateToDelta(i,t,n)});return this};jQuery.fn.roundabout_updateChildPositions=function(){this.each(function(e){var t=jQuery(this),n=t.data("roundabout"),r=-1,i={bearing:jQuery.roundabout_getBearing(t),tilt:n.tilt,stage:{width:Math.floor(t.width()*.9),height:Math.floor(t.height()*.9)},animating:n.animating,inFocus:n.childInFocus,focusBearingRad:jQuery.roundabout_degToRad(n.focusBearing),shape:jQuery.roundabout_shape[n.shape]||jQuery.roundabout_shape[jQuery.roundabout_shape.def]};i.midStage={width:i.stage.width/2,height:i.stage.height/2};i.nudge={width:i.midStage.width+i.stage.width*.05,height:i.midStage.height+i.stage.height*.05};i.zValues={min:n.minZ,max:n.maxZ,diff:n.maxZ-n.minZ};i.opacity={min:n.minOpacity,max:n.maxOpacity,diff:n.maxOpacity-n.minOpacity};i.scale={min:n.minScale,max:n.maxScale,diff:n.maxScale-n.minScale};t.children(n.childSelector).each(function(e){if(jQuery.roundabout_updateChildPosition(jQuery(this),t,i,e)&&i.animating===0){r=e;jQuery(this).addClass("roundabout-in-focus")}else jQuery(this).removeClass("roundabout-in-focus")});if(r!==i.inFocus){jQuery.roundabout_triggerEvent(t,i.inFocus,"blur");r!==-1&&jQuery.roundabout_triggerEvent(t,r,"focus");n.childInFocus=r}});return this};jQuery.roundabout_getBearing=function(e){return jQuery.roundabout_toFloat(e.data("roundabout").bearing)%360};jQuery.roundabout_degToRad=function(e){return e%360*Math.PI/180};jQuery.roundabout_isInFocus=function(e,t){return jQuery.roundabout_getBearing(e)%360===t%360};jQuery.roundabout_triggerEvent=function(e,t,n){return t<0?this:jQuery(e.children(e.data("roundabout").childSelector)[t]).trigger(n)};jQuery.roundabout_toFloat=function(e){e=Math.round(parseFloat(e)*1e3)/1e3;return parseFloat(e.toFixed(2))};jQuery.roundabout_updateChildPosition=function(e,t,n,r){var i=jQuery(e),s=i.data("roundabout"),o=[],u=jQuery.roundabout_degToRad(360-i.data("roundabout").degrees+n.bearing);while(u<0)u+=Math.PI*2;while(u>Math.PI*2)u-=Math.PI*2;var a=n.shape(u,n.focusBearingRad,n.tilt);a.scale=a.scale>1?1:a.scale;a.adjustedScale=(n.scale.min+n.scale.diff*a.scale).toFixed(4);a.width=(a.adjustedScale*s.startWidth).toFixed(4);a.height=(a.adjustedScale*s.startHeight).toFixed(4);i.css("left",(a.x*n.midStage.width+n.nudge.width-a.width/2).toFixed(1)+"px").css("top",(a.y*n.midStage.height+n.nudge.height-a.height/2).toFixed(1)+"px").css("width",a.width+"px").css("height",a.height+"px").css("opacity",(n.opacity.min+n.opacity.diff*a.scale).toFixed(2)).css("z-index",Math.round(n.zValues.min+n.zValues.diff*a.z)).css("font-size",(a.adjustedScale*s.startFontSize).toFixed(2)+"px").attr("current-scale",a.adjustedScale);if(t.data("roundabout").debug===!0){o.push('<div style="font-weight: normal; font-size: 10px; padding: 2px; width: '+i.css("width")+'; background-color: #ffc;">');o.push('<strong style="font-size: 12px; white-space: nowrap;">Child '+r+"</strong><br />");o.push("<strong>left:</strong> "+i.css("left")+"<br /><strong>top:</strong> "+i.css("top")+"<br />");o.push("<strong>width:</strong> "+i.css("width")+"<br /><strong>opacity:</strong> "+i.css("opacity")+"<br />");o.push("<strong>z-index:</strong> "+i.css("z-index")+"<br /><strong>font-size:</strong> "+i.css("font-size")+"<br />");o.push("<strong>scale:</strong> "+i.attr("current-scale"));o.push("</div>");i.html(o.join(""))}return jQuery.roundabout_isInFocus(t,i.data("roundabout").degrees)};